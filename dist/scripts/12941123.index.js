"use strict";var loadMediaScene=function(){var a={version:"1",name:"scene1",scene:[{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://www.safehavenrr.org/Images/bunny.jpg",anmiationIn:"default",anmiationOut:"default",cachePolicy:"default",tags:"rabbit"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://www.rabbit.org/adoption/bunny.jpg",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"rabbit"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://www.ikea.com/us/en/images/products/kritter-childrens-chair__0096632_PE236603_S4.JPG",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"chair"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://upload.wikimedia.org/wikipedia/commons/2/2c/Art_deco_club_chair.jpg",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"chair"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://research.fuseink.com/artifactimg/201210/MTM1MTUwOTc2MDE1MjYxXzE.jpg",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"rabbit, chair"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://bestrainer.net/wp-content/uploads/2012/07/Captura-de-pantalla-2012-07-12-a-las-09.09.21-301x398.png",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"rabbit, chair"}}]};return function(){var b=$.url().param("scene");return b&&localStorage[b]?JSON.parse(localStorage[b]):a}}(),mediaScenePlayer=function(){var a=function(a){var b=_.map(a.split(","),function(a){return a.trim()});return _.filter(b,function(a){return""!==a})},b=function(a,b){return b.length>0?_.filter(a.scene,function(a){return _.intersection(a.mediaObject.tags,b).length>0?!0:void 0}):a.scene},c={showMediaObject:function(a,b){var c=this.el;switch(b&&c.empty(),a.type){case"image":this.showImage(a.url,b);break;case"video":var d=$('<div id="youtubePlayer"></div>');c.append(d);{new YT.Player("youtubePlayer",{height:"300",width:"500",videoId:$.url(a.url).param("v"),playerVars:{controls:0,showinfo:0,modestbranding:1,playsinline:1},events:{onReady:function(a){a.target.playVideo()}}})}}},showImage:function(a){var b=this.el,c=this;return this.makeImage(a,function(a){a.addClass("image-media-object"),b.append(a),c.animateInImage(a)})},setMediaScene:function(c){var d=_.clone(c);d.scene=_.map(d.scene,function(b){return b.mediaObject.tags=a(b.mediaObject.tags),b}),this.filteredMediaObjects=b(d,this.tagTokens),this.mediaScene=d},playScene:function(){var a=this;setInterval(function(){var b=a.randomImage();if(b){var c=b.mediaObject.url,d=a.showImage(c);setTimeout(function(){a.animateOutImage(d)},6e3)}else console.log("no image to show")},3e3)},randomImage:function(){var a=this.filteredMediaObjects;return a[Math.floor(Math.random()*a.length)]},animateInImage:function(a){a.css({left:Math.random()*(this.elWidth-a.width()),top:Math.random()*(this.elHeight-a.height())}),TweenLite.to(a,2,{opacity:1})},animateOutImage:function(a){TweenLite.to(a,2,{opacity:0,onComplete:function(){a.remove()}})},makeImage:function(a,b){var c=new Image,d=$(c);return c.onload=function(){b(d)},c.src=a,d},filterByTags:function(c){this.tagTokens=c?a(c):[],this.mediaScene&&(this.filteredMediaObjects=b(this.mediaScene,this.tagTokens))}},d=function(a,b,d){var e=Object.create(c);return e.el=a,e.elWidth=a.width(),e.elHeight=a.height(),e.filterByTags(d),b&&(e.setMediaScene(b),e.playScene()),e};return d}(),MediaSceneEditor=Ractive.extend({addMediaObject:function(){this.get("newTags")},init:function(a){this.set("mediaScene",a.mediaScene),this.mediaPlayer=a.mediaPlayer,this.on({newMediaObject:function(a){var b={url:this.get("newUrl"),animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:this.get("newTags")};switch(this.get("mediaType")){case"image":b=_.extend(b,{name:"image",type:"image",mimeType:"image/jpeg"});break;case"video":b=_.extend(b,{name:"video",type:"video"});break;case"audio":}this.getScene().push({mediaObject:b}),this.set({newUrl:"",newTags:""}),a.original.preventDefault()},preview:function(a){this.mediaPlayer.showMediaObject(this.get(a.keypath).mediaObject,!0)},remove:function(a){var b=a.index.i;this.getScene().splice(b,1)},displayScene:function(){var a=this.get("mediaScene.name");localStorage[a]=JSON.stringify(this.get("mediaScene")),window.location.href="scene.html?scene="+a},updateScene:function(a){var b=JSON.parse(a.node.value);this.set("mediaScene",b)},acceptMediaType:function(a,b){this.set("mediaType",b)}})},getScene:function(){return this.get("mediaScene.scene")}});new MediaSceneEditor({el:"editor",data:{mediaType:"image"},template:"#media-scene-editor",mediaPlayer:mediaScenePlayer($("#canvas")),mediaScene:loadMediaScene()});