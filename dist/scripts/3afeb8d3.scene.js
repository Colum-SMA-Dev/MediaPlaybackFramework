"use strict";var loadMediaScene=function(){var a={version:"1",name:"scene1",scene:[{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://www.safehavenrr.org/Images/bunny.jpg",anmiationIn:"default",anmiationOut:"default",cachePolicy:"default",tags:"rabbit"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://www.rabbit.org/adoption/bunny.jpg",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"rabbit"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://www.ikea.com/us/en/images/products/kritter-childrens-chair__0096632_PE236603_S4.JPG",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"chair"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://upload.wikimedia.org/wikipedia/commons/2/2c/Art_deco_club_chair.jpg",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"chair"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://research.fuseink.com/artifactimg/201210/MTM1MTUwOTc2MDE1MjYxXzE.jpg",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"rabbit, chair"}},{mediaObject:{name:"image",type:"image",mimeType:"image/jpeg",url:"http://bestrainer.net/wp-content/uploads/2012/07/Captura-de-pantalla-2012-07-12-a-las-09.09.21-301x398.png",animiationIn:"default",animiationOut:"default",cachePolicy:"default",tags:"rabbit, chair"}}]};return function(){var b=$.url().param("scene");return b&&localStorage[b]?JSON.parse(localStorage[b]):a}}(),mediaScenePlayer=function(){var a=function(a){var b=_.map(a.split(","),function(a){return a.trim()});return _.filter(b,function(a){return""!==a})},b=function(a,b,c){return _.filter(a.scene,function(a){return!(0==b.length||_.intersection(a.mediaObject.tags,b).length>0)||c&&a.mediaObject.type!==c?void 0:!0})},c=!1,d=[],e=function(a){if(c&&a)a();else{a&&d.push(a);var b=document.createElement("script");b.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("body")[0];e.appendChild(b),window.onYouTubeIframeAPIReady=function(){c=!0,d.forEach(function(a){a()})}}},f={showMediaObject:function(a,b){var c=this.el,d=this;switch(b&&c.empty(),a.type){case"image":var e=this.showImage(a.url,b);this.timeouts.push(setTimeout(function(){d.animateOutImage(e)},6e3));break;case"video":var f=$('<div id="youtubePlayer"></div>');c.append(f),this.youtubePlayer=new YT.Player("youtubePlayer",{height:"300",width:"500",videoId:$.url(a.url).param("v"),playerVars:{controls:0,showinfo:0,modestbranding:1,playsinline:1},events:{onReady:function(a){a.target.playVideo()},onStateChange:function(a){a.data==YT.PlayerState.ENDED&&(d.youtubePlayer.destroy(),d.showRandomMediaObject("video"))}}});break;case"audio":this.audioPlayer=new Howl({urls:[a.url],onend:function(){d.showRandomMediaObject("audio")}}).play()}},showImage:function(a){var b=this.el,c=this;return this.makeImage(a,function(a){a.addClass("image-media-object"),b.append(a),c.animateInImage(a)})},setMediaScene:function(b){b.scene=_.map(b.scene,function(b){return b.mediaObject.tags=a(b.mediaObject.tags),b}),this.mediaScene=b,this.filterByTags(this.tagString)},playScene:function(){var a=this;e(function(){a.el.empty();var b=function(){a.showRandomMediaObject("image")};a.intervals.push(setInterval(b,3e3)),b(),a.showRandomMediaObject("video"),a.showRandomMediaObject("audio")})},stopScene:function(){this.el.stop(!0),this.youtubePlayer&&this.youtubePlayer.stopVideo(),this.audioPlayer&&this.audioPlayer.stop(),_.map(this.intervals,clearInterval),_.map(this.timeouts,clearTimeout),this.intervals=[],this.timeouts=[]},getRandomMedia:function(a){var b=this.filteredMediaObjects[a],c=b[Math.floor(Math.random()*b.length)];return c?c:void console.log("no "+a+"s in current scene")},showRandomMediaObject:function(a){var b=this.getRandomMedia(a);b&&this.showMediaObject(b.mediaObject)},animateInImage:function(a){a.css({left:Math.random()*(this.elWidth-a.width()),top:Math.random()*(this.elHeight-a.height())}),a.animate({opacity:1},1400)},animateOutImage:function(a){a.animate({opacity:0},1400,function(){a.remove()})},makeImage:function(a,b){var c=new Image,d=$(c);return c.onload=function(){b(d)},c.src=a,d},filterByTags:function(c){this.tagString=c;var d=[];c&&(d=a(c)),this.filteredMediaObjects={},this.mediaScene&&(this.filteredMediaObjects.image=b(this.mediaScene,d,"image"),this.filteredMediaObjects.video=b(this.mediaScene,d,"video"),this.filteredMediaObjects.audio=b(this.mediaScene,d,"audio"))}},g=function(a,b,c){var d=Object.create(f);return d.el=a,d.elWidth=a.width(),d.elHeight=a.height(),d.intervals=[],d.timeouts=[],d.filterByTags(c),e(),b&&(d.setMediaScene(b),d.playScene()),d};return g}(),player=mediaScenePlayer($("body"),loadMediaScene());$(".edit-scene").attr("href","index.html?scene="+$.url().param("scene")),$(".tag-filter").blur(function(){player.filterByTags(this.value)});